
#ifndef Buzzer_h
#define Buzzer_h
#include "Arduino.h"
#define A3_8 0
#define As3_8 1
#define B3_8 2
#define C4_8 3
#define Cs4_8 4
#define D4_8 5
#define Ds4_8 6
#define E4_8 7
#define F4_8 8
#define Fs4_8 9
#define G4_8 10
#define Gs4_8 11
#define A4_8 12
#define As4_8 13
#define B4_8 14
#define C5_8 15
#define Cs5_8 16
#define D5_8 17
#define Ds5_8 18
#define E5_8 19
#define F5_8 20
#define Fs5_8 21
#define G5_8 22
#define Gs5_8 23
#define A5_8 24
#define As5_8 25
#define B5_8 26
#define C6_8 27
#define Cs6_8 28
#define D6_8 29
#define Ds6_8 30
#define E6_8 31
#define F6_8 32
#define Fs6_8 33
#define G6_8 34
#define Gs6_8 35
#define A6_8 36
#define As6_8 37
#define B6_8 38
#define C7_8 39
#define Cs7_8 40
#define D7_8 41
#define Ds7_8 42
#define E7_8 43
#define F7_8 44
#define Fs7_8 45
#define G7_8 46
#define Gs7_8 47
#define A7_8 48
#define As7_8 49
#define B7_8 50
#define C8_8 51
#define Cs8_8 52
#define D8_8 53
#define Ds8_8 54
#define E8_8 55
#define F8_8 56
#define Fs8_8 57
#define G8_8 58
#define Gs8_8 59
#define A3_4 60
#define As3_4 61
#define B3_4 62
#define C4_4 63
#define Cs4_4 64
#define D4_4 65
#define Ds4_4 66
#define E4_4 67
#define F4_4 68
#define Fs4_4 69
#define G4_4 70
#define Gs4_4 71
#define A4_4 72
#define As4_4 73
#define B4_4 74
#define C5_4 75
#define Cs5_4 76
#define D5_4 77
#define Ds5_4 78
#define E5_4 79
#define F5_4 80
#define Fs5_4 81
#define G5_4 82
#define Gs5_4 83
#define A5_4 84
#define As5_4 85
#define B5_4 86
#define C6_4 87
#define Cs6_4 88
#define D6_4 89
#define Ds6_4 90
#define E6_4 91
#define F6_4 92
#define Fs6_4 93
#define G6_4 94
#define Gs6_4 95
#define A6_4 96
#define As6_4 97
#define B6_4 98
#define C7_4 99
#define Cs7_4 100
#define D7_4 101
#define Ds7_4 102
#define E7_4 103
#define F7_4 104
#define Fs7_4 105
#define G7_4 106
#define Gs7_4 107
#define A7_4 108
#define As7_4 109
#define B7_4 110
#define C8_4 111
#define Cs8_4 112
#define D8_4 113
#define Ds8_4 114
#define E8_4 115
#define F8_4 116
#define Fs8_4 117
#define G8_4 118
#define Gs8_4 119
#define A3_2 120
#define As3_2 121
#define B3_2 122
#define C4_2 123
#define Cs4_2 124
#define D4_2 125
#define Ds4_2 126
#define E4_2 127
#define F4_2 128
#define Fs4_2 129
#define G4_2 130
#define Gs4_2 131
#define A4_2 132
#define As4_2 133
#define B4_2 134
#define C5_2 135
#define Cs5_2 136
#define D5_2 137
#define Ds5_2 138
#define E5_2 139
#define F5_2 140
#define Fs5_2 141
#define G5_2 142
#define Gs5_2 143
#define A5_2 144
#define As5_2 145
#define B5_2 146
#define C6_2 147
#define Cs6_2 148
#define D6_2 149
#define Ds6_2 150
#define E6_2 151
#define F6_2 152
#define Fs6_2 153
#define G6_2 154
#define Gs6_2 155
#define A6_2 156
#define As6_2 157
#define B6_2 158
#define C7_2 159
#define Cs7_2 160
#define D7_2 161
#define Ds7_2 162
#define E7_2 163
#define F7_2 164
#define Fs7_2 165
#define G7_2 166
#define Gs7_2 167
#define A7_2 168
#define As7_2 169
#define B7_2 170
#define C8_2 171
#define Cs8_2 172
#define D8_2 173
#define Ds8_2 174
#define E8_2 175
#define F8_2 176
#define Fs8_2 177
#define G8_2 178
#define Gs8_2 179
#define A3_1 180
#define As3_1 181
#define B3_1 182
#define C4_1 183
#define Cs4_1 184
#define D4_1 185
#define Ds4_1 186
#define E4_1 187
#define F4_1 188
#define Fs4_1 189
#define G4_1 190
#define Gs4_1 191
#define A4_1 192
#define As4_1 193
#define B4_1 194
#define C5_1 195
#define Cs5_1 196
#define D5_1 197
#define Ds5_1 198
#define E5_1 199
#define F5_1 200
#define Fs5_1 201
#define G5_1 202
#define Gs5_1 203
#define A5_1 204
#define As5_1 205
#define B5_1 206
#define C6_1 207
#define Cs6_1 208
#define D6_1 209
#define Ds6_1 210
#define E6_1 211
#define F6_1 212
#define Fs6_1 213
#define G6_1 214
#define Gs6_1 215
#define A6_1 216
#define As6_1 217
#define B6_1 218
#define C7_1 219
#define Cs7_1 220
#define D7_1 221
#define Ds7_1 222
#define E7_1 223
#define F7_1 224
#define Fs7_1 225
#define G7_1 226
#define Gs7_1 227
#define A7_1 228
#define As7_1 229
#define B7_1 230
#define C8_1 231
#define Cs8_1 232
#define D8_1 233
#define Ds8_1 234
#define E8_1 235
#define F8_1 236
#define Fs8_1 237
#define G8_1 238
#define Gs8_1 239
#define REST_1_8 240
#define REST_2_8 241
#define REST_3_8 242
#define REST_4_8 243
#define REST_5_8 244
#define REST_6_8 245
#define REST_7_8 246
#define REST_8_8 247
#define REST_9_8 248
#define REST_10_8 249
#define REST_11_8 250
#define REST_12_8 251
#define REST_13_8 252
#define REST_14_8 253
#define REST_15_8 254

#define LAST_NOTE Gs8_1

#define BUZZER_MINUTE_BEEP_FREQUENCY 4000 //beep at each minute with this frequency
#define BUZZER_MINUTEBEEP_DURATION_MILLIS 20
#define BUZZER_MINUTEBEEP_DURATION_MILLIS 20
#define BUZZER_ALARM_FREQUENCY 2000
#define BUZZER_ALARM_DURATION_MILLIS 1000000

#define BUZZER_NEXTPLAYER_BEEP_FREQUENCY 500
#define BUZZER_NEXTPLAYER_DURATION_MILLIS 20
#define BUZZER_NEXTPLAYER_MULTIPLEBEEP_INTERVAL_MILLIS 100

#define BUZZER_OVERLAP_TO_PREVENT_GAP_BETWEEN_EQUAL_NOTES_MILLIS 5 //

#define BUZZER_NOTES_BUFFERVALUE_BUTTONPRESS
#define BUZZER_NOTES_BUFFERVALUE_PAUSE
#define BUZZER_NOTES_BUFFERVALUE_UNPAUSE
#define BUZZER_NOTES_BUFFERVALUE_STARTGAME
#define BUZZER_NOTES_BUFFERVALUE_ENDGAME

#define BUZZER_NOTES_BUFFER_LENGTH 103 // accomodate for "the longest songs..." or find another way to split songs in half.

#define BUZZER_NOTES_BUFFER_SONG_STOPVALUE 255

// #define BUZZER_NOTES_BUFFER_EIGHTNOTE_DURATION_MILLIS 63
#define BUZZER_NOTES_BUFFER_EIGHTNOTE_DURATION_MILLIS 15
#define BUZZER_NOTES_BUFFER_BASE_FREQUENCY 220

#define NOTES_COUNT 60 // spans 5 octaves

class Buzzer
{
public:
    Buzzer();

    void setPin(uint8_t pin);
    uint8_t getPin();
    void addNoteToNotesBuffer(uint8_t note);
    uint8_t addRandomSoundToNotesBuffer(uint8_t lowest, uint8_t highest);
    void checkAndPlayNotesBuffer();
    uint8_t getNextProgramIndex();
    uint8_t getNextPlayIndex();
    uint8_t getBuzzerNotesBufferEmpty();

    void changeTranspose(int8_t delta);
    void setTranspose(int8_t offset);
    void changeSpeedRatio(int8_t delta);
    void setSpeedRatio(float speedMultiplier);

    void clearBuzzerNotesBuffer();
    void playTone(unsigned int freq, unsigned long duration_millis);
    void buzzerSilentClearBuffer();
    void buzzerSilent();

    void lastPlayedNoteToDisplay(char *textBuf, uint8_t *decimalPoints);
    void noteToDisplay(char *textBuf, uint8_t *decimalPoints, uint8_t note);

    uint8_t getLength(uint8_t note);
    void changeNoteToNextLength(int16_t *note);

private:
    float speedScale;
    int8_t transpose;
    uint8_t pin;
    uint8_t buzzerNotesBuffer[BUZZER_NOTES_BUFFER_LENGTH];
    uint8_t bufferPlayIndex;
    uint8_t bufferProgramIndex;
    unsigned long soundFinishedTimeMillis;

    bool noteFinishedEdge;
};
#endif
